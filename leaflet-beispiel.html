<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"
    />

    <style>
      .map {
        position: absolute;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map" class="map"></div>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script>
      // Initialisiert die Karte und setzt die Ansicht auf einen spezifischen Punkt und Zoomlevel
      var map = L.map('map').setView([52.151222, 9.961226], 13)

      // Lädt und zeigt das Basis-Kartenmaterial von OpenStreetMap
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors',
      }).addTo(map)

      function removeWaypoint(index) {
        var waypoints = routingControl.getWaypoints()
        if (waypoints.length > 2) {
          // Verhindern, dass die letzten zwei Wegpunkte entfernt werden
          waypoints.splice(index, 1)
          routingControl.setWaypoints(waypoints)
        }
      }

      // Routing-Control-Initialisierung mit Start- und Endpunkt
      var routingControl = L.Routing.control({
        waypoints: [
          L.latLng(52.134119, 9.974163),
          L.latLng(52.134158, 9.967912),
        ],
        routeWhileDragging: true,
        geocoder: L.Control.Geocoder.nominatim(),

        createMarker: function (i, waypoint, n) {
          var marker = L.marker(waypoint.latLng, {
            draggable: true,
          })

          // Event-Listener für das Klicken auf den Marker
          marker.on('click', function () {
            removeWaypoint(i)
          })

          return marker
        },

        router: new L.Routing.osrmv1({
          serviceUrl: 'http://164.92.235.183:5000/route/v1',
          profile: 'foot',
        }),
      }).addTo(map)

      // Funktion, die bei einem Klick auf die Karte aufgerufen wird
      function onMapClick(e) {
        // Fügt einen neuen Wegpunkt am Ort des Klicks hinzu
        routingControl.spliceWaypoints(
          routingControl.getWaypoints().length - 1,
          0,
          e.latlng
        )
      }

      // Event-Listener, der auf Klicks auf der Karte reagiert
      map.on('click', onMapClick)
    </script>
  </body>
</html>
